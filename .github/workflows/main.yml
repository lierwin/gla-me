name: Deploy to Meteor Galaxy

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '14' # Meteor 兼容性较好

      - name: Install Meteor
        run: |
          npm install -g meteor
          # 或者使用官方脚本: curl https://install.meteor.com/ | sh

      - name: Install Dependencies
        run: meteor npm install

      - name: Deploy to Galaxy
        env:
          METEOR_SESSION_TOKEN: ${{ secrets.METEOR_SESSION_TOKEN }}
          # 如果你的 package.json 没有指定 settings.json，可以在这里通过 --settings 传递
          # 这里假设你的环境变量都写在代码里的 defaults 或者通过 Galaxy 后台配置
        run: |
          meteor deploy galaxy-beta.meteor.com --free --mongo --owner ${{ secrets.METEOR_OWNER }} 
          # 注意：
          # 1. galaxy-beta.meteor.com 是部署地址，--free 表示使用免费计划
          # 2. 如果你有特定域名，替换 galaxy-beta... 为你的域名
          # 3. --owner 是可选的，如果部署到组织账号下需要
